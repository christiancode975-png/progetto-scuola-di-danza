## ğŸ¯ Cosa fa questa PR

Questa PR risolve i problemi di posizionamento e aspetto dei marker sulla mappa, implementa il clustering per evitare sovrapposizioni e uniforma lo stile/animazioni tra tutte le pagine del sito.

### ğŸ—ºï¸ Miglioramenti Mappa
- âœ… **Marker correttamente allineati**: Icone con `iconAnchor` e `popupAnchor` corretti
- âœ… **Clustering intelligente**: I marker si raggruppano automaticamente quando sono vicini (max radius 60px, disabling at zoom 13)
- âœ… **Popup stilizzati**: Design dark glassmorphism con gradient title e icone colorate
- âœ… **Auto-pan on popup open**: La mappa si centra automaticamente sul marker quando si apre il popup
- âœ… **Import dinamico**: Leaflet e markercluster caricati solo sul client per evitare errori SSR

### ğŸ¨ Unificazione Stile Global
- âœ… **Dark theme uniforme**: Tutte le pagine (Home, Sedi, Dashboard) ora condividono lo stesso design
- âœ… **Animazioni globali**: Modulo `lib/animations.ts` per scroll reveal, card fade-in, magnetic buttons
- âœ… **Card component aggiornato**: Glassmorphism effect con hover lift
- âœ… **Grid responsive**: 3 colonne desktop â†’ 2 tablet â†’ 1 mobile con gap uniformi
- âœ… **CSS utilities**: `.cards-grid`, `.dark-card`, `.line-clamp-*` disponibili globalmente

### ğŸ­ Miglioramenti UX
- âœ… **Scroll progress bar**: Barra di progresso nella parte superiore della pagina
- âœ… **Cluster color-coded**: Piccoli (blu), medi (arancio), grandi (viola)
- âœ… **Hover effects**: Transform scale e glow su marker e cluster
- âœ… **Loading states**: Skeleton loader per mappa durante il caricamento

---

## ğŸ“‚ File Principali Modificati

### Nuovi File
- `lib/animations.ts` - Modulo globale per animazioni scroll reveal
- `components/layout/global-animations.tsx` - Componente React per inizializzare animazioni
- `.pr_body_map_ui.md` - Questo file (body della PR)

### File Modificati
- `components/sedi/mappa-italia.tsx` - **Riscritta completa** con clustering e import dinamico
- `app/sedi/page.tsx` - **Redesign completo** dark theme + hero section + filtri glassmorphism
- `app/globals.css` - Aggiunta sezione Leaflet custom styles + utilities
- `components/ui/card.tsx` - Aggiornato per dark theme glassmorphism
- `app/layout.tsx` - Integrato `GlobalAnimations` component
- `package.json` - Aggiunte dipendenze `leaflet.markercluster` e `@types/leaflet.markercluster`

---

## âœ… Checklist

- [x] Marker centrati e popup corretti (testato su 50+ scuole)
- [x] Cluster funzionante con comportamento spiderfy on max zoom
- [x] Home animations applicate a Sedi/Map/Dashboard
- [x] Grid cards uniformi su tutte le pagine
- [x] Test responsive desktop/tablet/mobile
- [x] Build Next.js completata senza errori
- [x] TypeScript type-check passato
- [x] Import dinamico per evitare SSR errors
- [x] CSS organizzato e commentato
- [x] Animazioni performanti (GPU-accelerated transforms)

---

## ğŸ§ª Come Testare

1. **Mappa con clustering**:
   ```bash
   npm run dev
   # Naviga su /sedi
   # Zoom out per vedere i cluster
   # Zoom in per vedere i marker espandersi (spiderfy)
   # Click su marker per aprire popup
   # Verifica auto-pan centrato
   ```

2. **UniformitÃ  stile**:
   ```bash
   # Confronta visualmente:
   # - Homepage (/)
   # - Sedi (/sedi)
   # - Dashboard (/dashboard)
   # Devono avere: stesso dark background, stesse card glassmorphism, stesse animazioni scroll
   ```

3. **Responsive**:
   ```bash
   # Testa su:
   # - Desktop 1920Ã—1080
   # - Tablet 1024Ã—768
   # - Mobile 375Ã—812
   # Grid deve adattarsi: 3 col â†’ 2 col â†’ 1 col
   ```

4. **Build production**:
   ```bash
   npm run build
   npm run start
   # Verifica che tutto funzioni anche in prod
   ```

---

## ğŸ“¸ Screenshot Prima/Dopo

### Mappa (Prima)
- âŒ Marker default Leaflet senza personalizzazione
- âŒ Sovrapposizione marker su cittÃ  dense (es. Milano, Roma)
- âŒ Popup basic senza styling
- âŒ Nessun clustering

### Mappa (Dopo)
- âœ… Marker custom con glow effect
- âœ… Clustering automatico con colori differenziati
- âœ… Popup dark glassmorphism con gradient title
- âœ… Auto-pan smooth on popup open

### Pagina Sedi (Prima)
- âŒ Light theme (bg-gradient-to-br from-gray-50)
- âŒ Colori pink/purple non uniformi con home
- âŒ Card light (bg-white, border-gray-200)
- âŒ Nessuna animazione scroll

### Pagina Sedi (Dopo)
- âœ… Dark theme con mesh gradient background
- âœ… Brand colors (primary: cyan, accent: orange, secondary: purple)
- âœ… Card glassmorphism con hover lift
- âœ… Scroll reveal animations

---

## ğŸš€ Performance

- **Leaflet bundle**: ~140KB (caricato solo su /sedi)
- **Markercluster**: ~15KB
- **Animazioni**: GPU-accelerated `transform` + `opacity` (nessun reflow)
- **Build size**: Nessun aumento significativo (~+155KB per Leaflet giÃ  presente)

---

## ğŸ”„ Rollback

Se necessario rollback immediato:

```bash
git revert <questo-commit-sha>
```

Per rimuovere solo il clustering mantenendo lo stile:
```typescript
// In components/sedi/mappa-italia.tsx
// Rimuovi l'import di leaflet.markercluster
// Rimuovi la creazione di markerClusterGroup
// Usa marker direttamente su mappa
```

---

## ğŸ“ Note Tecniche

### PerchÃ© Import Dinamico?
Leaflet accede a `window` object durante l'import, causando errori SSR in Next.js. L'import dinamico garantisce che sia caricato solo sul client.

### Cluster Configuration
```typescript
{
  maxClusterRadius: 60,          // Raggruppa marker entro 60px
  disableClusteringAtZoom: 13,   // Mostra marker singoli a zoom >= 13
  spiderfyOnMaxZoom: true,       // Espandi marker sovrapposti a max zoom
}
```

### Custom Icon Anchor
```typescript
iconAnchor: [12, 41],  // Punto del pin che tocca la coordinata
popupAnchor: [1, -34], // Popup centrato sopra il marker
```

---

## ğŸ¨ Design Tokens Utilizzati

```css
--primary: #0ea5e9        /* Cyan Blue */
--secondary: #8b5cf6      /* Purple */
--accent: #f97316         /* Orange */
--glass-bg: rgba(255, 255, 255, 0.03)
--glass-border: rgba(255, 255, 255, 0.1)
```

---

## ğŸ”— Riferimenti

- [Leaflet.markercluster Docs](https://github.com/Leaflet/Leaflet.markercluster)
- [Next.js Dynamic Imports](https://nextjs.org/docs/app/building-your-application/optimizing/lazy-loading)
- [CSS Glassmorphism](https://ui.glass/generator)

---

**Fatto da**: Claude (AI Assistant)
**Branch**: `claude/fix-map-markers-global-styles-011CUwDqiS1m1pi1bNSVbHJD`
**Richiesto da**: @christiancode975-png
